<!DOCTYPE html>
<html>

	<head>
		<title>Content Manager</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="robots" content="noindex" />
		<!-- Include the Netlify indentity widget -->
		<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
	</head>

	<body>
		<!-- Include the script that builds the page and powers Decap CMS -->
		<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

		<script>
			if (window.netlifyIdentity) {
				window.netlifyIdentity.on("init", user => {
					if (!user) {
						window.netlifyIdentity.on("login", () => {
							document.location.href = "/admin/";
						});
					} else {
						// Custom function call after login
						callCustomAuthFunction(user);
					}
				});

				window.netlifyIdentity.on("login", user => {
					callCustomAuthFunction(user);
				});

				function callCustomAuthFunction(user) {
					// Example: call the auth function with the user's token
					fetch('/.netlify/functions/auth', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Authorization': `Bearer ${user.token.access_token}`
						},
						body: JSON.stringify({ user })
					})
						.then(response => response.json())
						.then(data => {
							console.log('Custom auth function response:', data);
						})
						.catch(error => {
							console.error('Error calling custom auth function:', error);
						});
				}
			}
		</script>

	</body>

</html>
